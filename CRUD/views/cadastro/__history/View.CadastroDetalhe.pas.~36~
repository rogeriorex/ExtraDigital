unit View.CadastroDetalhe;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics, Vcl.Controls,
  Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls, Data.DB, Vcl.Mask, Vcl.DBCtrls, Vcl.Buttons,
  FireDAC.Comp.Client;

type
  TfrmCadastroDetalhe = class(TForm)
    pnlOpcoes: TPanel;
    pnlCadastro: TPanel;
    btnSalvar: TBitBtn;
    btnCancelar: TBitBtn;
    procedure btnSalvarClick(Sender: TObject);
    procedure btnCancelarClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormDestroy(Sender: TObject);
  public
    LMaximoValorID: integer;
    DataSetLocal: TFDQuery;
    DataSetAux: TFDQuery;
    procedure IDNovoRegistro(const ATabela: String; const ACampo: String);
  end;

var
  frmCadastroDetalhe: TfrmCadastroDetalhe;

implementation

uses
  Model.Cadastro;

const
  SELECT_MAXIMO_VALOR_ID = 'SELECT MAX(';
  FROM_MAXIMO_VALOR_ID = ') FROM ';

{$R *.dfm}

procedure TfrmCadastroDetalhe.btnCancelarClick(Sender: TObject);
begin
  if DataSetLocal.State in [dsEdit, dsInsert] then
    DataSetLocal.Cancel;
  Close;
end;

procedure TfrmCadastroDetalhe.btnSalvarClick(Sender: TObject);
begin
  if DataSetLocal.State in [dsEdit, dsInsert] then
    DataSetLocal.Post;
  Close;
end;

procedure TfrmCadastroDetalhe.FormCreate(Sender: TObject);
begin
  DataSetLocal := TFDQuery.Create(Self);
  DataSetAux := TFDQuery.Create(Self);
end;

procedure TfrmCadastroDetalhe.FormDestroy(Sender: TObject);
begin
  DataSetLocal := nil;
  DataSetAux := nil;
end;

procedure TfrmCadastroDetalhe.IDNovoRegistro(const ATabela: String; const ACampo: String);
begin
  DataSetAux.Open(SELECT_MAXIMO_VALOR_ID + ACampo + FROM_MAXIMO_VALOR_ID + ATabela);
  LMaximoValorID := DataSetAux.Fields[0].Asinteger;
  DataSetLocal.FieldByName(ACampo).AsInteger := Succ(LMaximoValorID);
end;

end.
